<header class="m-3 align-items-center justify-content-center d-flex">
  <h1>Aadhar and PAN Card OCR</h1>
</header>

<section>
  @if (!refreshing) {
    <div class="container">
      <div class="row d-flex justify-content-center align-items-center">
        <div class="col">
          <img ngSrc="assets/aadhar.png" alt="aadhar" height="300" width="500" priority>
          <div class="d-flex m-3">Choose Aadhar documents</div>
          <input type="file" id="aadhar" name="aadhar" (change)="onAadharFileSelected($event)" multiple><br><br>
          <ul>
            @for (file of aadharFiles; track i; let i = $index) {
              <li>
                {{ file.name }}
                <button (click)="removeFile(aadharFiles, i)">Remove</button>
              </li>
            }
          </ul>
          <div class="btn-group">
            <button type="submit" class="btn btn-primary" (click)="processAadharFiles()">Upload</button>
            <button type="submit" class="btn btn-info ms-2" (click)="processAadharWithMultipassThresholding()">Multi-Pass Thresholding</button>
          </div>
        </div>
        <div class="col">
          <img ngSrc="assets/pan.png" alt="pan" height="300" width="500" priority>
          <div class="d-flex m-3">Choose PAN documents</div>
          <input type="file" id="pan" name="pan" (change)="onPanFileSelected($event)" multiple><br><br>
          <ul>
            @for (file of panFiles; track i; let i = $index) {
              <li>
                {{ file.name }}
                <button (click)="removeFile(panFiles,i)">Remove</button>
              </li>
            }
          </ul>
          <button type="submit" class="btn btn-primary" (click)="processPanFiles()">Upload</button>
        </div>
      </div>

      <!-- Results Section -->
      @if (extractedResults.length > 0) {
        <div class="row mt-4">
          <div class="col-12">
            <h3>Extracted Data</h3>
            <table class="table table-striped">
              <thead>
                <tr>
                  <th style="width: 150px;">Document</th>
                  <th>Name</th>
                  <th>Number</th>
                  <th>DOB</th>
                  <th>Address</th>
                  <th>Mobile</th>
                  <th>File Name</th>
                  <th>Card Type</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                @for (result of extractedResults; track result.fileName; let i = $index) {
                  <tr style="height: 120px; vertical-align: middle;">
                    <td class="text-center" style="width: 150px;">
                      @if (result.sourceUrl) {
                        <div class="image-zoom-container" style="position: relative; height: 100px; width: 120px; margin: 0 auto;">
                          <a [href]="result.sourceUrl" target="_blank">
                            <img [src]="result.sourceUrl" class="img-thumbnail document-preview" 
                                 style="height: 100px; width: 120px; object-fit: contain; transition: transform 0.3s ease;"
                                 alt="Document preview"
                                 (mouseover)="showZoomedImage($event)" 
                                 (mouseout)="hideZoomedImage()">
                          </a>
                          <div id="zoomedPreview" class="zoomed-preview" style="display: none; position: absolute; z-index: 100; border: 2px solid #ccc; background-color: white; box-shadow: 0 0 10px rgba(0,0,0,0.3);">
                            <!-- Zoomed image will be displayed here -->
                          </div>
                        </div>
                      } @else {
                        <span class="text-muted">No preview</span>
                      }
                    </td>
                    <td>
                      <input type="text" class="form-control form-control-sm" [(ngModel)]="result.name">
                    </td>
                    <td>
                      <input type="text" class="form-control form-control-sm" [(ngModel)]="result.number">
                    </td>
                    <td>
                      <input type="text" class="form-control form-control-sm" [(ngModel)]="result.dob">
                    </td>
                    <td>
                      <input type="text" class="form-control form-control-sm" [(ngModel)]="result.address">
                    </td>
                    <td>
                      <input type="text" class="form-control form-control-sm" [(ngModel)]="result.mobile">
                    </td>
                    <td>{{ result.fileName }}</td>
                    <td>{{ result.cardType }}</td>
                    <td>
                      <button class="btn btn-sm btn-danger" (click)="removeExtractedResult(i)">âœ•</button>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
            <div class="mt-3">
              <button class="btn btn-success me-2" (click)="saveToFile()">Save to Selected File</button>
              <button class="btn btn-info me-2" (click)="downloadCSV('AADHAR')">Download Aadhar Data</button>
              <button class="btn btn-warning me-2" (click)="downloadCSV('PAN')">Download PAN Data</button>
              <button class="btn btn-secondary" (click)="changeStorageLocation()">Change Storage Location</button>
            </div>
          </div>
        </div>
      }
      
      <!-- Processing indicator -->
      @if (isProcessing) {
        <div class="row mt-4">
          <div class="col-12 text-center">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Processing files, please wait...</p>
          </div>
        </div>
      }
    </div>
  }
</section>
